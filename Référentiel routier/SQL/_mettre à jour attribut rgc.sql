-- Ce script permet le remplissage de l'attribut métier "RGC" utile pour identifier les Routes à Grande Circulation (RGC) fixées par décret.
--
-- NDLR :
-- Lien vers le décret pour le département du Gard : https://www.legifrance.gouv.fr/affichTexteArticle.do;jsessionid=F64B9771F7A0F0D9BECCE74EF9A1F829.tplgfr24s_3?cidTexte=JORFTEXT000020692049&idArticle=LEGIARTI000022296568&dateTexte=20181103&categorieLien=id#LEGIARTI000022296568
--
-- TODO :
-- Adapter ce script de sorte à renseigner les RGC du département.
--
-- Syntaxe pour une RD complète :
-- update Troncon
-- set RGC = true
-- where NumeroRoute = '<NumeroRoute>';
--
-- Syntaxe pour une section de RD :
-- update Troncon
-- set RGC = true
-- where NumeroRoute = '<NumeroRoute>'
-- and IdIGN in (
--     select _IdIGN
--     from RechercherTronconsEntreIdIGN(
--         '<NumeroRoute>',
--         array['<Tronçon 1 de début de section>', '<Tronçon 2 de début de section>', ..., '<Tronçon N de début de section>'],
--         array['<Tronçon 1 de fin de section>', '<Tronçon 2 de fin de section>', ..., '<Tronçon N de fin de section>']
--     )
-- );

-- mise à false préalable pour tous les tronçons
update Troncon set RGC = false;

-- 30; D127; D135; NIMES; D135; POULX
update Troncon
set RGC = true
where NumeroRoute = 'D127'
and IdIGN in (
    select _IdIGN
    from RechercherTronconsEntreIdIGN(
        'D127',
        array['TRONROUT0000000027905334'],
        array['TRONROUT0000000027899938']
    )
);

-- 30; D135; D127; POULX; D979; NIMES
-- 30; D135; D6086; MARGUERITTES; D127; NIMES
-- 30; D135; D6086; NIMES; D6572; VAUVERT
update Troncon
set RGC = true
where NumeroRoute = 'D135'
and IdIGN in (
    select _IdIGN
    from RechercherTronconsEntreIdIGN(
        'D135',
        array['TRONROUT0000000298211539', 'TRONROUT0000000298211540', 'TRONROUT0000000298211546', 'TRONROUT0000000298211538', 'TRONROUT0000000298211547'],
        array['TRONROUT0000000324756979', 'TRONROUT0000000324756974', 'TRONROUT0000000324756977', 'TRONROUT0000000027972170', 'TRONROUT0000000027973522', 'TRONROUT0000000324756978', 'TRONROUT0000000027973520', 'TRONROUT0000000027973521', 'TRONROUT0000000027972171']
    )
);

-- 30; D192; D6100; FOURNES; A9; FOURNES
update Troncon
set RGC = true
where NumeroRoute = 'D192'
and IdIGN in (
    select _IdIGN
    from RechercherTronconsEntreIdIGN(
        'D192',
        array['TRONROUT0000000027889114', 'TRONROUT0000000027889113', 'TRONROUT0000000027889115', 'TRONROUT0000000027889100', 'TRONROUT0000000027889110'],
        array['TRONROUT0000000027886551', 'TRONROUT0000000027886559', 'TRONROUT0000000027886562', 'TRONROUT0000000027886569', 'TRONROUT0000000027886563', 'TRONROUT0000000027886560', 'TRONROUT0000000027886558', 'TRONROUT0000000027886568', 'TRONROUT0000000027886561', 'TRONROUT0000000027886556', 'TRONROUT0000000027886557', 'TRONROUT0000000027886564']
    )
);

-- 30; D2; D702; ARAMON; D986L; VALLABREGUES
update Troncon
set RGC = true
where NumeroRoute = 'D2'
and IdIGN in (
    select _IdIGN
    from RechercherTronconsEntreIdIGN(
        'D2',
        array['TRONROUT0000002215457059', 'TRONROUT0000002215457057', 'TRONROUT0000002215457060', 'TRONROUT0000002215457061', 'TRONROUT0000002215457062', 'TRONROUT0000002215457063'],
        array['TRONROUT0000000027909967']
    )
);

-- 30; D42; D135; CAISSARGUES; D442; SAINT-GILLES
update Troncon
set RGC = true
where NumeroRoute = 'D42'
and IdIGN in (
    select _IdIGN
    from RechercherTronconsEntreIdIGN(
        'D42',
        array['TRONROUT0000000027947554', 'TRONROUT0000000027947558', 'TRONROUT0000000027947550', 'TRONROUT0000000259273799', 'TRONROUT0000000027947549', 'TRONROUT0000000259273781', 'TRONROUT0000000027947548', 'TRONROUT0000000027947552', 'TRONROUT0000000027947635', 'TRONROUT0000000259273802', 'TRONROUT0000000027947626', 'TRONROUT0000000027947551'],
        array['TRONROUT0000000027954435', 'TRONROUT0000000027954419', 'TRONROUT0000000027954414', 'TRONROUT0000000027954415', 'TRONROUT0000000027954410', 'TRONROUT0000000027954417', 'TRONROUT0000000027954421', 'TRONROUT0000000027954436']
    )
);

-- 30; D442; D6113; BOUILLARGUES; D42; SAINT-GILLES
update Troncon
set RGC = true
where NumeroRoute = 'D442';

-- 30; D6; N580; BAGNOLS-SUR-CEZE; D60; ALES
update Troncon
set RGC = true
where NumeroRoute = 'D6'
and IdIGN in (
    select _IdIGN
    from RechercherTronconsEntreIdIGN(
        'D6',
        array['TRONROUT0000000027812467', 'TRONROUT0000000027812440', 'TRONROUT0000000027812489', 'TRONROUT0000000027812485', 'TRONROUT0000000027812483', 'TRONROUT0000000027812482', 'TRONROUT0000000027812481', 'TRONROUT0000000027812487', 'TRONROUT0000000027812486', 'TRONROUT0000000027812484', 'TRONROUT0000000249688693', 'TRONROUT0000000027812490', 'TRONROUT0000000027812488'],
        array['TRONROUT0000000027795699', 'TRONROUT0000000027795675', 'TRONROUT0000000027795703', 'TRONROUT0000000027795707', 'TRONROUT0000000027795690', 'TRONROUT0000000027795704', 'TRONROUT0000000027795695', 'TRONROUT0000000027795694', 'TRONROUT0000000027795691', 'TRONROUT0000000027795692']
    )
);

-- 30; D60; D904; SAINT-MARTIN-DE-VALGALGUES; N106; ALES
update Troncon
set RGC = true
where NumeroRoute = 'D60'
and IdIGN in (
    select _IdIGN
    from RechercherTronconsEntreIdIGN(
        'D60',
        array['TRONROUT0000000027803773'],
        array['TRONROUT0000000027821667', 'TRONROUT0000000027821631', 'TRONROUT0000000027821678']
    )
);

-- 30; D6086; Limite département 30/07; PONT-SAINT-ESPRIT; N86; PONT-SAINT-ESPRIT
update Troncon
set RGC = true
where NumeroRoute = 'D6086'
and IdIGN in (
    select _IdIGN
    from RechercherTronconsEntreIdIGN(
        'D6086',
        array['TRONROUT0000000027771728'],
        array['TRONROUT0000000027775904', 'TRONROUT0000000027775902', 'TRONROUT0000000027775895', 'TRONROUT0000000027775907', 'TRONROUT0000000027775896', 'TRONROUT0000000027775906', 'TRONROUT0000000027775901', 'TRONROUT0000000027775867', 'TRONROUT0000000027775894']
    )
);

-- 30; D6086; A9 Nîmes Est; NIMES; D135; MARGUERITTES
update Troncon
set RGC = true
where NumeroRoute = 'D6086'
and IdIGN in (
    select _IdIGN
    from RechercherTronconsEntreIdIGN(
        'D6086',
        array['TRONROUT0000000027916058', 'TRONROUT0000000027916053'],
        array['TRONROUT0000000274512347', 'TRONROUT0000000274512348', 'TRONROUT0000000027919224', 'TRONROUT0000000274512298', 'TRONROUT0000000258780556', 'TRONROUT0000000274512295', 'TRONROUT0000000027919186', 'TRONROUT0000000027919220', 'TRONROUT0000000274512299', 'TRONROUT0000000274512296']
    )
);

-- 30; D61; Limite département 30/34; AIGUES-MORTES; D62; AIGUES-MORTES
-- en gestion D34

-- 30; D6100; Extrémité RN 100; LES ANGLES; Limite département 30/84; LES ANGLES
update Troncon
set RGC = true
where NumeroRoute = 'D6100'
and IdIGN in (
    select _IdIGN
    from RechercherTronconsEntreIdIGN(
        'D6100',
        array['TRONROUT0000000027879211', 'TRONROUT0000000027879212'],
        array['TRONROUT0000000027882521', 'TRONROUT0000000027882496']
    )
);

-- 30; D62; D979; AIGUES-MORTES; Extrémité; AIGUES-MORTES
update Troncon
set RGC = true
where NumeroRoute = 'D62';

-- 30; D640; N106; NIMES; D40; NIMES
update Troncon
set RGC = true
where NumeroRoute = 'D640';

-- 30; D90; D986L; BEAUCAIRE; Limite département 30/13; BEAUCAIRE
update Troncon
set RGC = true
where NumeroRoute = 'D90';

-- 30; D904; Limite département 30/07; COURRY; D60; SAINT-MARTIN-DE-VALGALGUES
update Troncon
set RGC = true
where NumeroRoute = 'D904';

-- 30; D979; D112; SAINTE-ANASTASIE; Extrémité PR. 66+780; NIMES
update Troncon
set RGC = true
where NumeroRoute = 'D979'
and IdIGN in (
    select _IdIGN
    from RechercherTronconsEntreIdIGN(
        'D979',
        array['TRONROUT0000000027886918'],
        array['TRONROUT0000000027919585']
    )
);

-- 30; D979; D62; AIGUES-MORTES; D6313; AIMARGUES
update Troncon
set RGC = true
where NumeroRoute = 'D979'
and IdIGN in (
    select _IdIGN
    from RechercherTronconsEntreIdIGN(
        'D979',
        array['TRONROUT0000000027973705', 'TRONROUT0000000027973706', 'TRONROUT0000000027973701', 'TRONROUT0000000027973721', 'TRONROUT0000000027973707', 'TRONROUT0000000027973693', 'TRONROUT0000000027973692', 'TRONROUT0000000027973709', 'TRONROUT0000000027973754', 'TRONROUT0000000027973700'],
        array['TRONROUT0000000027980555', 'TRONROUT0000000027980122', 'TRONROUT0000000027980150', 'TRONROUT0000000027980152', 'TRONROUT0000000027980134', 'TRONROUT0000000027980153', 'TRONROUT0000000027980149', 'TRONROUT0000000027980121', 'TRONROUT0000000027980144', 'TRONROUT0000000027980141', 'TRONROUT0000000027980133']
    )
);

-- 30; D986L; D6086; REMOULINS; D90; BEAUCAIRE
update Troncon
set RGC = true
where NumeroRoute = 'D986L'
and IdIGN in (
    select _IdIGN
    from RechercherTronconsEntreIdIGN(
        'D986L',
        array['TRONROUT0000000220650478', 'TRONROUT0000000220650451', 'TRONROUT0000000220173851', 'TRONROUT0000000220173850'],
        array['TRONROUT0000000027927573', 'TRONROUT0000000027927589']
    )
);

-- 30; D994; D6086; PONT-SAINT-ESPRIT; Limite département 30/84; PONT-SAINT-ESPRIT
update Troncon
set RGC = true
where NumeroRoute = 'D994';

-- 30; D999; D6086; NIMES; D90; BEAUCAIRE
update Troncon
set RGC = true
where NumeroRoute = 'D999'
and IdIGN in (
    select _IdIGN
    from RechercherTronconsEntreIdIGN(
        'D999',
        array['TRONROUT0000000027935382', 'TRONROUT0000000027935385', 'TRONROUT0000002215581936', 'TRONROUT0000000027935364', 'TRONROUT0000000027935381', 'TRONROUT0000000027935359', 'TRONROUT0000000027935371', 'TRONROUT0000000217274193', 'TRONROUT0000002002165044', 'TRONROUT0000000027935358', 'TRONROUT0000000027935380', 'TRONROUT0000000027935375'],
        array['TRONROUT0000000027928360', 'TRONROUT0000000027928366']
    )
);

-- remise à null pour des tronçons qui ne sont pas "réels"
update Troncon t
set RGC = null
where t.IdTroncon not in (select IdTroncon from TronconReel);